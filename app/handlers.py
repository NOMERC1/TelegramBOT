from aiogram import F, Router
from aiogram.types import Message, CallbackQuery
from aiogram.filters import CommandStart
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext

import app.keyboards as kb
import app.database.requests as rq

router = Router()

class Register(StatesGroup):
    fio = State()
    distance = State()
    date = State()

@router.message(CommandStart())
async def cmd_start(message: Message):
    await message.answer('–ü—Ä–∏–≤–µ—Ç! '
                         '–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–∞—Ñ–æ–Ω—ã!üèÉ‚Äç‚ôÇüèÖ\n\n',
                         reply_markup=kb.main)

@router.message(F.text == '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è')
async def registration(message: Message, state: FSMContext):
    await state.set_state(Register.fio)
    await message.answer('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–¥–µ–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω!üèÉ‚Äç‚ôÇüèÖ\n'
                         '–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ –§–ò–û.')

@router.message(F.text == '–ö–æ–Ω—Ç–∞–∫—Ç—ã')
async def contact_info(message: Message):
    await message.answer('–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –≤–∞–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–≤—è–∑–∏ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏ –º–∞—Ä–∞—Ñ–æ–Ω–∞.'
                         '–í—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–∞–º –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º:'
                         '\n\n–¢–µ–ª–µ—Ñ–æ–Ω: +7 (951) 406-59-25‚òé\n'
                         'Email: p9ito40k@mail.ruüìß'
                         '\n\n–ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∞–º —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –∏ –æ—Ç–∑—ã–≤–∞–º–∏.'
                         '–ú—ã –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º!')

@router.message(F.text == '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤')
async def marathon_results(message: Message):
    await message.answer('–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤! –í–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π:\n\n'
                         'üèÖ –î–∏—Å—Ç–∞–Ω—Ü–∏—è 5 –∫–º: üèÉ‚Äç‚ôÇ\n'
                         '1. –ò–≤–∞–Ω–æ–≤–∞ –û–ª—å–≥–∞, –≤—Ä–µ–º—è: 25:34\n'
                         '2. –ü–µ—Ç—Ä–æ–≤ –ê–ª–µ–∫—Å–µ–π, –≤—Ä–µ–º—è: 27:15\n'
                         '3. –°–º–∏—Ä–Ω–æ–≤–∞ –ò—Ä–∏–Ω–∞, –≤—Ä–µ–º—è: 28:20\n\n'
                         'üèÖ–î–∏—Å—Ç–∞–Ω—Ü–∏—è 10 –∫–º:üèÉ‚Äç‚ôÇ\n'
                         '1. –ö–æ–∑–ª–æ–≤ –ò–≤–∞–Ω, –≤—Ä–µ–º—è: 45:10\n'
                         '2. –°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞, –≤—Ä–µ–º—è: 50:05\n'
                         '3. –ú–∏—Ö–∞–π–ª–æ–≤ –ü–∞–≤–µ–ª, –≤—Ä–µ–º—è: 52:03\n\n'
                         '–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤—Å–µ—Ö –∑–∞ —É—á–∞—Å—Ç–∏–µ!'
                         '–ñ–¥–µ–º –≤–∞—Å —Å–Ω–æ–≤–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö')

@router.message(F.text == '–ü–æ–º–æ—â—å')
async def participator(message: Message):
    await message.answer('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∫–∏!'
                         '–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å, –º—ã –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º. ü§ù\n\n'
                         '–≠—Ç–æ—Ç –±–æ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —É–¥–æ–±–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω—ã –∏ '
                         '–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞—Ö –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö. üèÉ‚Äç‚ôÇüèÖ\n\n'
                         '–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É '
                         '"–Ø —Ö–æ—á—É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω".'
                         '–ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –§–ò–û,'
                         '–≤—ã–±–µ—Ä–∏—Ç–µ –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂ –º–∞—Ä–∞—Ñ–æ–Ω–∞ –∏ —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Ä–∞—Ñ–æ–Ω–∞. üìùüëüüóì\n\n'
                         '–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –æ —Å–≤–æ–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ö, '
                         '–Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ú–æ–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ—ë –§–ò–û.'
                         '–í—ã –ø–æ–ª—É—á–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞—Ä–∞—Ñ–æ–Ω–∞—Ö –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.üìã\n\n'
                         '–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –Ω–∞—Å, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û –Ω–∞—Å".'
                         '–ê –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è –∏–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, '
                         '–Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ö–æ–Ω—Ç–∞–∫—Ç—ã", —á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏. ‚úâüìû')

@router.message(F.text == '–û –Ω–∞—Å')
async def participator(message: Message):
    await message.answer('–ú—ã - –∫–æ–º–∞–Ω–¥–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤,'
                         '–∫–æ—Ç–æ—Ä–∞—è —Å –≥–æ—Ä–¥–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–µ—Ç –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è '
                         '–¥–ª—è –≤—Å–µ—Ö –ª—é–±–∏—Ç–µ–ª–µ–π –±–µ–≥–∞ –∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏.üèÉ‚Äç‚ôÇüèÖ\n\n'
                         '–£–∂–µ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –º–Ω–æ–≥–∏—Ö –ª–µ—Ç –º—ã —É—Å–ø–µ—à–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –º–∞—Ä–∞—Ñ–æ–Ω—ã,'
                         '–ø—Ä–∏–Ω–æ—Å—è —Ä–∞–¥–æ—Å—Ç—å –∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å–æ –≤—Å–µ—Ö —É–≥–æ–ª–∫–æ–≤.'
                         '–ù–∞—à–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ–ª—å–∑—É—é—Ç—Å—è –±–æ–ª—å—à–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å—é, '
                         '–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏, '
                         '–ø–æ–ª—É—á–∞—è –∑–∞—Å–ª—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑—ã –∏ –Ω–∞–≥—Ä–∞–¥—ã. üéâüèÜ\n\n'
                         '–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –Ω–∞—Å, '
                         '–Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–ö–æ–Ω—Ç–∞–∫—Ç—ã". '
                         '–ú—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –æ–±—â–µ–Ω–∏—é –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º!üí¨')

@router.message(Register.fio)
async def register_fio(message: Message, state: FSMContext):
    await state.update_data(fio=message.text)
    await message.answer('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –º–∞—Ä–∞—Ñ–æ–Ω–∞:', reply_markup=await kb.distances())

@router.callback_query(F.data.startswith('distance_'))
async def distance(callback: CallbackQuery, state: FSMContext):
    distance_text = callback.data.split('_')[1]
    await callback.answer('–í—ã –≤—ã–±—Ä–∞–ª–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –º–∞—Ä–∞—Ñ–æ–Ω–∞')
    await state.update_data(distance=distance_text)
    await callback.message.answer('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –º–∞—Ä–∞—Ñ–æ–Ω–∞:',
                                  reply_markup=await kb.dates(callback.data.split('_')[1]))

@router.callback_query(F.data.startswith('date_'))
async def date(callback: CallbackQuery, state: FSMContext):
    date_text = callback.data.split('_')[1]
    await callback.answer('–í—ã –≤—ã–±—Ä–∞–ª–∏ –¥–∞—Ç—É –º–∞—Ä–∞—Ñ–æ–Ω–∞')
    await state.update_data(date=date_text)
    data = await state.get_data()
    fio = data.get('fio')
    distance = data.get('distance')
    date = data.get('date')
    await rq.set_user(callback.from_user.id, fio, distance, date)
    await callback.message.answer('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! '
                                  '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. '
                                  '–í—ã —Å—Ç–∞–ª–∏ —á–∞—Å—Ç—å—é –Ω–∞—à–µ–π —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π –≥–æ–Ω–∫–∏ –Ω–∞ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å. '
                                  '–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–º—É –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—é, –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–º—É –≤—ã–∑–æ–≤–æ–≤ –∏ –ø–æ–±–µ–¥! '
                                  '–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Å—Ç–∞—Ä—Ç—É –∏ –±—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã –≤—ã–ª–æ–∂–∏—Ç—å—Å—è –ø–æ –ø–æ–ª–Ω–æ–π –Ω–∞ —Ç—Ä–∞—Å—Å–µ. '
                                  '–£–¥–∞—á–∏! üèÉüèª‚Äç‚ôÇüèÉüèº‚Äç‚ôÄüéΩ')